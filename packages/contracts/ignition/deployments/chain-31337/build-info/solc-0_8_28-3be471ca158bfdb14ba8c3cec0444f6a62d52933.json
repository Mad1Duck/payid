{
  "_format": "hh3-sol-build-info-1",
  "id": "solc-0_8_28-3be471ca158bfdb14ba8c3cec0444f6a62d52933",
  "solcVersion": "0.8.28",
  "solcLongVersion": "0.8.28+commit.7893614a",
  "userSourceNameMap": {
    "contracts/AttestationVerifier.sol": "project/contracts/AttestationVerifier.sol"
  },
  "input": {
    "language": "Solidity",
    "settings": {
      "evmVersion": "cancun",
      "optimizer": {
        "enabled": true,
        "runs": 200
      },
      "outputSelection": {
        "*": {
          "": [
            "ast"
          ],
          "*": [
            "abi",
            "evm.bytecode",
            "evm.deployedBytecode",
            "evm.methodIdentifiers",
            "metadata"
          ]
        }
      },
      "remappings": []
    },
    "sources": {
      "project/contracts/AttestationVerifier.sol": {
        "content": "// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.20;\r\n\r\n/**\r\n * @title AttestationVerifier (EAS-based)\r\n * @notice Verifies attestations via Ethereum Attestation Service (EAS)\r\n *         Fully serverless — no trusted issuer server needed.\r\n *         Client hanya perlu query EAS UID dan pass ke sini.\r\n *\r\n * EAS Deployments:\r\n *   Ethereum Mainnet : 0xA1207F3BBa224E2c9c3c6D5aF63D0eb1582Ce587\r\n *   Base             : 0x4200000000000000000000000000000000000021\r\n *   Optimism         : 0x4200000000000000000000000000000000000020\r\n *   Arbitrum One     : 0xbD75f629A22Dc1ceD33dDA0b68c546A1c035c458\r\n *   Sepolia (testnet): 0xC2679fBD37d54388Ce493F1DB75320D236e1815e\r\n */\r\n\r\n/* ===================== EAS INTERFACE ===================== */\r\n\r\ninterface IEAS {\r\n    struct Attestation {\r\n        bytes32 uid;\r\n        bytes32 schema;\r\n        uint64  time;\r\n        uint64  expirationTime;\r\n        uint64  revocationTime;\r\n        bytes32 refUID;\r\n        address attester;\r\n        address recipient;\r\n        bool    revocable;\r\n        bytes   data;\r\n    }\r\n\r\n    function getAttestation(bytes32 uid)\r\n        external\r\n        view\r\n        returns (Attestation memory);\r\n\r\n    function isAttestationValid(bytes32 uid)\r\n        external\r\n        view\r\n        returns (bool);\r\n}\r\n\r\n/* ===================== CONTRACT ===================== */\r\n\r\ncontract AttestationVerifier {\r\n\r\n    /* ===================== ERRORS ===================== */\r\n    error UntrustedAttester();\r\n    error WrongSchema();\r\n    error AttestationExpired();\r\n    error AttestationRevoked();\r\n    error AttestationNotForPayer();\r\n    error AttestationNotFound();\r\n    error ReplayAttestation();\r\n    error LengthMismatch();\r\n    error NotOwner();\r\n    error ZeroAddress();\r\n\r\n    /* ===================== STORAGE ===================== */\r\n\r\n    IEAS    public immutable eas;\r\n\r\n    // Schemas yang diizinkan (kamu define schema di EAS registry)\r\n    mapping(bytes32 => bool) public trustedSchemas;\r\n\r\n    // Attesters yang diizinkan (Worldcoin, Gitcoin, KYC provider, dll)\r\n    mapping(address => bool) public trustedAttesters;\r\n\r\n    // Replay protection untuk one-time attestation\r\n    mapping(bytes32 => bool) public usedAttestations;\r\n\r\n    address public owner;\r\n\r\n    /* ===================== EVENTS ===================== */\r\n    event SchemaUpdated(bytes32 indexed schemaUID, bool trusted);\r\n    event AttesterUpdated(address indexed attester, bool trusted);\r\n    event OwnershipTransferred(address indexed prev, address indexed next);\r\n\r\n    /* ===================== MODIFIER ===================== */\r\n    modifier onlyOwner() {\r\n        if (msg.sender != owner) revert NotOwner();\r\n        _;\r\n    }\r\n\r\n    /* ===================== CONSTRUCTOR ===================== */\r\n\r\n    /**\r\n     * @param easAddress       EAS contract address sesuai chain\r\n     * @param initialSchemas   List schema UID yang diizinkan\r\n     * @param initialAttesters List attester yang diizinkan (Worldcoin, Gitcoin, dll)\r\n     */\r\n    constructor(\r\n        address          easAddress,\r\n        bytes32[] memory initialSchemas,\r\n        address[] memory initialAttesters\r\n    ) {\r\n        if (easAddress == address(0)) revert ZeroAddress();\r\n\r\n        eas   = IEAS(easAddress);\r\n        owner = msg.sender;\r\n\r\n        for (uint256 i = 0; i < initialSchemas.length; ) {\r\n            trustedSchemas[initialSchemas[i]] = true;\r\n            emit SchemaUpdated(initialSchemas[i], true);\r\n            unchecked { ++i; }\r\n        }\r\n\r\n        for (uint256 i = 0; i < initialAttesters.length; ) {\r\n            trustedAttesters[initialAttesters[i]] = true;\r\n            emit AttesterUpdated(initialAttesters[i], true);\r\n            unchecked { ++i; }\r\n        }\r\n    }\r\n\r\n    /* ===================== ADMIN ===================== */\r\n\r\n    function setTrustedSchema(bytes32 schemaUID, bool trusted)\r\n        external\r\n        onlyOwner\r\n    {\r\n        trustedSchemas[schemaUID] = trusted;\r\n        emit SchemaUpdated(schemaUID, trusted);\r\n    }\r\n\r\n    function setTrustedAttester(address attester, bool trusted)\r\n        external\r\n        onlyOwner\r\n    {\r\n        if (attester == address(0)) revert ZeroAddress();\r\n        trustedAttesters[attester] = trusted;\r\n        emit AttesterUpdated(attester, trusted);\r\n    }\r\n\r\n    function transferOwnership(address newOwner) external onlyOwner {\r\n        if (newOwner == address(0)) revert ZeroAddress();\r\n        emit OwnershipTransferred(owner, newOwner);\r\n        owner = newOwner;\r\n    }\r\n\r\n    /* ===================== INTERNAL VERIFY ===================== */\r\n\r\n    /**\r\n     * @notice Core verification — dipanggil oleh semua public verify functions\r\n     * @param attestationUID  UID dari EAS attestation (didapat client dari EAS SDK)\r\n     * @param payer           Address yang harus jadi recipient attestation\r\n     */\r\n    function _verifyEASAttestation(\r\n        bytes32 attestationUID,\r\n        address payer\r\n    ) internal view {\r\n        // 1. Fetch attestation dari EAS contract (on-chain, no server)\r\n        IEAS.Attestation memory att = eas.getAttestation(attestationUID);\r\n\r\n        // 2. Attestation harus exist\r\n        if (att.uid == bytes32(0)) revert AttestationNotFound();\r\n\r\n        // 3. Schema harus trusted\r\n        if (!trustedSchemas[att.schema]) revert WrongSchema();\r\n\r\n        // 4. Attester harus trusted (Worldcoin, Gitcoin, KYC provider)\r\n        if (!trustedAttesters[att.attester]) revert UntrustedAttester();\r\n\r\n        // 5. Recipient harus payer — attestation untuk orang yang bayar\r\n        if (att.recipient != payer) revert AttestationNotForPayer();\r\n\r\n        // 6. Belum expired (0 = tidak ada expiry)\r\n        if (\r\n            att.expirationTime != 0 &&\r\n            att.expirationTime <= block.timestamp\r\n        ) revert AttestationExpired();\r\n\r\n        // 7. Belum direvoke\r\n        if (att.revocationTime != 0) revert AttestationRevoked();\r\n\r\n        // 8. Double-check via EAS isAttestationValid\r\n        if (!eas.isAttestationValid(attestationUID)) revert AttestationRevoked();\r\n    }\r\n\r\n    /* ===================== PUBLIC VERIFY ===================== */\r\n\r\n    /**\r\n     * @notice Verify single EAS attestation (reusable)\r\n     * @param attestationUID  EAS attestation UID\r\n     * @param payer           Harus match dengan att.recipient\r\n     */\r\n    function verifyAttestation(\r\n        bytes32 attestationUID,\r\n        address payer\r\n    ) external view {\r\n        _verifyEASAttestation(attestationUID, payer);\r\n    }\r\n\r\n    /**\r\n     * @notice Verify attestation dan mark sebagai used (one-time use)\r\n     * @dev Cocok untuk high-value atau compliance use case\r\n     */\r\n    function verifyAttestationOnce(\r\n        bytes32 attestationUID,\r\n        address payer\r\n    ) external {\r\n        if (usedAttestations[attestationUID]) revert ReplayAttestation();\r\n        _verifyEASAttestation(attestationUID, payer);\r\n        usedAttestations[attestationUID] = true;\r\n    }\r\n\r\n    /**\r\n     * @notice Verify multiple attestations sekaligus (gas optimized)\r\n     * @dev Cocok untuk payer yang perlu multiple attestations\r\n     *      contoh: KYC attestation + AML attestation + Accredited Investor attestation\r\n     *\r\n     * @param attestationUIDs  Array EAS attestation UIDs\r\n     * @param payer            Semua attestation harus untuk payer yang sama\r\n     */\r\n    function verifyAttestationBatch(\r\n        bytes32[] calldata attestationUIDs,\r\n        address            payer\r\n    ) external view {\r\n        uint256 len = attestationUIDs.length;\r\n        for (uint256 i = 0; i < len; ) {\r\n            _verifyEASAttestation(attestationUIDs[i], payer);\r\n            unchecked { ++i; }\r\n        }\r\n    }\r\n\r\n    /* ===================== VIEW HELPERS ===================== */\r\n\r\n    /**\r\n     * @notice Cek apakah payer punya valid attestation untuk schema tertentu\r\n     *         Berguna untuk client-side pre-check sebelum build transaction\r\n     */\r\n    function hasValidAttestation(\r\n        bytes32 attestationUID,\r\n        address payer\r\n    ) external view returns (bool) {\r\n        try this.verifyAttestation(attestationUID, payer) {\r\n            return true;\r\n        } catch {\r\n            return false;\r\n        }\r\n    }\r\n}\r\n"
      }
    }
  }
}